# Analyse factorielle {#FA}


l'objectif des méthodes d'analyses factorielles est de réduire un ensemble de variables à un petit nombre de dimensions qui résument l'essentiel de l'information.

## Un peu de théorie

deux grandes approches marquent le paysage

la première est celle de l'ACP

La seconde est celle des psychologues et en particulier le modèle en terme de facteurs communs et spécifiques. 


## Application

```{r 0601, echo = TRUE, message=FALSE,warning=FALSE}
library(readr)
df <- read_csv("./Data/ESS1-9e01_1.csv")
ls(df)
```


 valeur de kahle


IPCRTIV Important to think new ideas and being creative
IMPRICH Important to be rich, have money and expensive things
IPEQOPT Important that people are treated equally and have equal opportunities
IPSHABT Important to show abilities and be admired
IMPSAFE Important to live in secure and safe surroundings
IMPDIFF Important to try new and different things in life
IPFRULE Important to do what is told and follow rules
IPUDRST Important to understand different people
IPMODST Important to be humble and modest, not draw attention
IPGDTIM Important to have a good time
IMPFREE Important to make own decisions and be free
IPHLPPL Important to help people and care for others well-being
IPSUCES Important to be successful and that people recognise achievements
IPSTRGV Important that government is strong and ensures safety
IPADVNT Important to seek adventures and have an exciting life
IPBHPRP Important to behave properly
IPRSPOT Important to get respect from others
IPLYLFR Important to be loyal to friends and devote to people close
IMPENV Important to care for nature and environment
IMPTRAD Important to follow traditions and customs
IMPFUN Important to seek fun and things that give pleasure


()

```{r 0602, echo = TRUE, message=FALSE,warning=FALSE}
library(tidyverse)


foo<-df %>% 
  dplyr::select(ipcrtiv,
         imprich, 
         ipeqopt, 
         ipshabt, 
         impsafe, 
         impdiff, 
         ipfrule, 
         ipudrst, 
         ipmodst, ipgdtim, impfree, iphlppl, ipsuces,ipstrgv, ipadvnt,ipbhprp,iprspot,iplylfr,impenv,imptrad, impfun)

library(psych)

fa <- fa(foo,4,fm="pa" ,rotate="promax")  #principal axis 
fa


```
```{r 0603, echo = TRUE, message=FALSE,warning=FALSE}

library(flextable)

#une fonction utile


flex <- function(data, title=NULL) {
  # this grabs the data and converts it to a flextbale
  flextable(data) %>%
  # this makes the table fill the page width
  set_table_properties(layout = "autofit", width = 1) %>%
  # font size
  fontsize(size=10, part="all") %>%
    #this adds a ttitlecreates an automatic table number
      set_caption(title, 
                  autonum = officer::run_autonum(seq_id = "tab", 
                                                 pre_label = "Table ", 
                                                 post_label = "\n", 
                                                 bkm = "anytable")) %>%
  # font type
  font(fontname="Times New Roman", part="all")
}

fa[["Vaccounted"]] %>%
  as.data.frame() %>%
  #select(1:5) %>% Use this if you have many factors and only want to show a certain number
  rownames_to_column("Property") %>%
    mutate(across(where(is.numeric), round, 3)) %>%
    flex("Eigenvalues and Variance Explained for Rotated Factor Solution")

#et une seconde fonction


fa_table <- function(x, cut) {
  #get sorted loadings
  loadings <- fa.sort(x)$loadings %>% round(3)
  #supress loadings
  loadings[loadings < cut] <- ""
  #get additional info
  add_info <- cbind(x$communalities, 
                    x$uniquenesses,
                    x$complexity) %>%
    # make it a data frame
    as.data.frame() %>%
    # column names
    rename("Communality" = V1,
           "Uniqueness" = V2,
           "Complexity" = V3) %>%
    #get the item names from the vector
    rownames_to_column("item")
  #build table
  loadings %>%
    unclass() %>%
    as.data.frame() %>%
    rownames_to_column("item") %>%
    left_join(add_info) %>%
    mutate(across(where(is.numeric), round, 3))
}

fa_table(fa, .32)%>%
  flex("A Pretty Factor Analysis Table")

```
